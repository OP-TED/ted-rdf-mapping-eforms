<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: eForms-mapping-docs</title>
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<div class="navbar-item has-dropdown is-hoverable">
<h1>TED-SWS</h1>
</div><div class="body">
<div class="nav-container" data-component="eforms-mappings" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">eForms mapping docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Home</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="methodology.html">Mapping Methodology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="package_structure.html">Mapping Suite Structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="usage.html">Usage Instructions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><span class="separated"><strong>General References</strong></span></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">eForms mapping docs</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">eForms mapping docs</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">eForms mapping docs</a></li>
    <li><a href="index.html">Home</a></li>
    <li><a href="methodology.html">Mapping Methodology</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="6">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_mapping_methodology"><a class="anchor" href="#_mapping_methodology"></a>Mapping Methodology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Developing mappings for eForms still follows the <a href="https://docs.ted.europa.eu/SWS/mapping_suite/methodology.html">sound principles of conceptual agreement followed by technical implementation</a>, divided into the distinct stages of <em>conceptual mapping</em> ( CM ) using a dialect of <a href="https://www.w3.org/TR/sparql11-property-paths/">SPARQL Path</a> patterns, and <em>technical mapping</em> ( TM ) using the <a href="https://rml.io/">RML mapping language</a>.</p>
</div>
<div class="sect2">
<h3 id="_eforms_sdk_field_definitions"><a class="anchor" href="#_eforms_sdk_field_definitions"></a>eForms SDK Field Definitions</h3>
<div class="paragraph">
<p>In contrast to SF, which had <a href="https://op.europa.eu/en/web/eu-vocabularies/e-procurement/tedschemas-archive">XSD schemas</a> as the only cue for the underlying model, there is an <a href="https://github.com/OP-TED/eForms-SDK">eForms SDK</a> which prescribes eForm XML element <a href="https://developer.mozilla.org/en-US/docs/Web/XPath">XPaths</a> in terms of nodes and fields, which lends an easier framework for the management and comprehension of the <a href="http://docs.oasis-open.org/ubl/os-UBL-2.3/UBL-2.3.html">UBL</a>-based XML model behind elements used across the eForm notices. The notices themselves are categorized under <a href="https://docs.ted.europa.eu/eforms/latest/schema/documents-forms-and-notices.html">document, form and notice types and subtypes</a>, such as Competition Notice, subtype 16 (EF16).</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_groups"><a class="anchor" href="#_mapping_groups"></a>Mapping Groups</h3>
<div class="paragraph">
<p>A new idea introduced into the mapping methodology is the notion of a Mapping Group (MG), which is a representation of RDF connections (relationships) and subject groupings in a simple, hyphen-delimited textual notation, in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">MG-{TrailingClass}-{intermediateClassAndPropertyPath}-{RootClass}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where, for example, the full path of an organisation&#8217;s address might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">MG-Address-hasAddress-Location-hasLocation-Organization</code></pre>
</div>
</div>
<div class="paragraph">
<p>This serves to provide an indication of how RDF statements are logically grouped together to form the right (connected) instances, given that data for a given subject may be spread across completely different XPaths in the source XML. That is why, in the technical mapping, MGs are used to form the subject URIs of the RML rules (TriplesMaps), suffixed with the node name (as per the SDK) where the information comes from, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">tedm:MG-Address-hasAddress-Location-hasLocation-Organization_ND-Company a rr:TriplesMap</code></pre>
</div>
</div>
<div class="paragraph">
<p>Different nodes usually require different subject templates or iterators, especially those which are located at entirely different or <em>orthogonal</em> XPaths, requiring as many RML TriplesMaps with the same MG but different node names.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modular_rml_mappings"><a class="anchor" href="#_modular_rml_mappings"></a>Modular RML Mappings</h3>
<div class="paragraph">
<p>Given the large number of mappings that are necessry for the conversion of a certain eForms Notice (the CM contains around 500 entries for various fields and nodes that belong to a type of notice), a mapping package ends up containing 200+ RML TriplesMaps with 500+ predicateObjectMap, resulting in more than 11,000 lines of RML code. To be able to efficiently and properly manage this amount of information, we split it up into multiple RML files that are organized following a certain logic.</p>
</div>
<div class="paragraph">
<p>The structure of the RML files (we call them <em>modules</em> because they are modular
files with RML rules that work together when combined) is based on the
primary/root class of a set of mapping rules, which are part of one or more
<em>Mapping Groups</em> (MGs) that share such a root class (the final segment of an MG
name). An MG represents a logical grouping of related instances/resources (like
a <code>foaf:Person</code> with all of its properties <em>and</em> relationships together with
the instances of those relationships).</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Multiple TriplesMaps in an RML Module</div>
<div class="content">
<div class="paragraph">
<p>For example, the <code>LotGroup.rml.ttl</code> file (as it appears in a <a href="https://github.com/OP-TED/ted-rdf-mapping-eforms/blob/1.0.0-rc.3/mappings/package_cn_v1.9/transformation/mappings/LotGroup.rml.ttl">mapping package</a> created for the conversion of the Competition Notices, eForms subtypes 10-24) contains the following TriplesMaps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">tedm:MG-LotGroup_ND-LotsGroup
tedm:MG-Identifier-identifier-LotGroup_ND-LotsGroup
tedm:MG-Identifier-hasInternalIdentifier-LotGroup_ND-LotsGroupProcurementScope
tedm:MG-LotGroup_ND-LotsGroupProcurementScope
tedm:MG-MonetaryValue-hasEstimatedValue-LotGroup_ND-LotsGroupValueEstimate
tedm:MG-MonetaryValue-hasLaunchFrameworkAgreementMaximumValue-LotGroup_ND-LotsGroupValueEstimateExtension
tedm:MG-MonetaryValue-hasLaunchFrameworkAgreementMaximumValue-LotGroup_ND-LotsGroupFA
tedm:MG-AwardCriterion-specifiesProcurementCriterion-LotGroup_ND-LotsGroupAwardCriterion
tedm:MG-AwardCriterion-specifiesProcurementCriterion-LotGroup_ND-LotsGroupAwardFixedCriterionParameter
tedm:MG-AwardCriterion-specifiesProcurementCriterion-LotGroup_ND-LotsGroupAwardWeightCriterionParameter
tedm:MG-Constraint-hasConstraint-AwardCriterion-specifiesProcurementCriterion-LotGroup_ND-LotsGroupAwardThresholdCriterionParameter</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looking at the above example we can observe that, on one hand, a node <code>ND-LotsGroup</code> can have children fields that provide information for the generation of multiple insctances, e.g. an <code>epo:LotGroup</code> instance from <code>tedm:MG-LotGroup_ND-LotsGroup</code>, and an <code>adms:Identifier</code> instance from <code>tedm:MG-Identifier-identifier-LotGroup_ND-LotsGroup</code>. On the other hand, the full definition of the same EPO instance, can achieved by combining information provided in fields that are organized under different nodes, e.g. the MonetaryValue that represents the hasLaunchFrameworkAgreementMaximumValue property of a LotGroup can come both from fields that are chidren of the <code>ND-LotsGroupValueEstimateExtension</code> node and those that are children of the <code>ND-LotsGroupFA</code> node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">tedm:MG-MonetaryValue-hasLaunchFrameworkAgreementMaximumValue-LotGroup_ND-LotsGroupValueEstimateExtension,
tedm:MG-MonetaryValue-hasLaunchFrameworkAgreementMaximumValue-LotGroup_ND-LotsGroupFA</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another advantage of creating modularized RML files, is that it allows us to easier handle the differences that appear in various SDK versions. Since fields and nodes can appear or disappear in any (major or minor) SDK version, we need to be able to write different RML mappings for different SDK versions. Some of these mapping are valid for all SDK version (that exist as of now), some are valid only for one particular SDK version, while others are valid up to or starting from a given SDK version. Our approach is to place these mappings in files whose name reflect the SDK versions for which they apply, and at the time when we create a mapping package for a given SDK version, we select oll the modeles that apply for that SDK version.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Multiple RML modules for mapping information about Lots</div>
<div class="content">
<div class="paragraph">
<p>For example, the RML mappings that are necessary to transform notices encoded according to eForms SDK v1.8 are organized in <a href="https://github.com/OP-TED/ted-rdf-mapping-eforms/tree/1.0.0-rc.4/mappings/package_cn_v1.8/transformation/mappings">more than 30 files</a>, from which the mappings for the Lot related information is organized in these files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-BASH hljs" data-lang="BASH">Lot.rml.ttl                 # mappings valid accross all SDK versions
Lot_v1.3-1.8.rml.ttl        # mappings valid up to SDK version 1.8 (inclusive)
Lot_v1.4+.rml.ttl           # mappings valid for all SDK versions starting with v1.4
Lot_v1.7+.rml.ttl           # mappings valid for all SDK versions starting with v1.7
Lot_v1.8+.rml.ttl           # mappings valid for all SDK versions starting with v1.8
Lot_v1.8-1.8.rml.ttl        # mappings valid for only SDK versions v1.8</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Important Note: </strong>
The TriplesMaps in the various RML modules, especially those that represent version specific mappings, can spread accross multiple files. For example, a TriplesMap can have it logical source/iterator, its subject map, and its various predicat-object maps in several files, depending on what aspect is specified in a given SDK version and/or belongs to a given module. However, this information needs to be provided and organized in such a manner that when they are combined together in a package, the RML mappings should be valid, complete, correct and non-conflicting. E.g. every TriplesMap, after the modules are combined, should have one and only one logical source and subject map, and the subject map and all predicate-obect maps should work with the logical source that they are conbined with.</p>
</div>
</div>
<div class="sect2">
<h3 id="ref:uri-scheme"><a class="anchor" href="#ref:uri-scheme"></a>RDF URI Scheme</h3>
<div class="paragraph">
<p>The eForms RML mappings use the following URI scheme for the representing ePO ontology instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{ns}id_{notice-id}_{concept}_{trailer}</code></pre>
</div>
</div>
<div class="paragraph">
<p>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{ns}</code> is a base namespace, in this case
<code><a href="http://data.europa.eu/a4g/resource/" class="bare">http://data.europa.eu/a4g/resource/</a></code></p>
</li>
<li>
<p><code>{concept}</code> is either (i) an ontology fragment label or (ii) source
element label, with a suffix or prefix</p>
</li>
<li>
<p><code>{trailer}</code> is either (i) an ID value (if the resource has one) or
(ii) an <em>online</em> computed, deterministic hash</p>
</li>
<li>
<p>Root concepts such as <code>epo:Notice</code> end up to only the <code>{concept}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Expanding on some of the components for further clarity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Whether a <code>concept</code> is an ontology fragment or source element label,
and whether this label has a suffix (rarely) or prefix, depends on the
subjective (human) evaluation of whether only having the class name is
sufficient hint of what the URI represents.</p>
</li>
<li>
<p>The trailer, when a hash, is computed (seeded) with the XPath named
element (e.g. <code>cbc:ID</code>) or (often relative) path (e.g. <code>path(cbc:ID)</code>)
of what is being mapped, and therefore lends a unique identity to the
URI. This yields reproducible URIs across RML TripleMaps, in case a
resource needed to be instantiated at different XPaths, for whatever
purpose.</p>
<div class="ulist">
<ul>
<li>
<p>A Lot or any other resource with an inherent ID, would simply have
its <code>cbc:ID</code> value as the trailer, for
e.g. <code>epd:id_14549263-b47b-4e59-96a1-2d0d13e19343_Lot_LOT-0001</code>, which
is very useful for linking purposes at orthogonal XPaths (e.g. wherever
an <code>id-ref</code> is concerned, that ID could simply be used to produce a
linkable URI without having to navigate XPaths).</p>
</li>
<li>
<p>Any other resource where there is no inherent ID would have a hash
that is unique to the XPath it represents, e.g. an <code>epo:Purpose</code>
instance, if instantiated at different XPaths for associating different
attributes, would have the same URI across those instantiations,
resulting in one unique instance and no duplication due to multiple
mappings.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>adms:Identifier</code>, although having an ID, may still get a hash
instead of ID in its trailer, as it may not have a short ID that is
sensible to use/read (however we may not have enforced this rule
strongly)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are exceptions to this policy, namely in the <em>trailer</em> segment, as that
is what lends uniqueness to a resource, and determines whether instances being
created from subject URI templates in the technical RML rules are correct. One
such exception are epo:AgentInRole instances, which
<a href="https://github.com/OP-TED/ted-rdf-mapping-eforms/issues/31">require a carefully
constructed URI</a> seeded with information about the related party (a
foaf:Agent).</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Wherever <em>URI</em> is mentioned,
<a href="https://www.w3.org/2001/Talks/0912-IUC-IRI/paper.html#:~:text=In%20principle%2C%20the%20definition%20of,us%2Dascii%20characters%20in%20URIs">IRI</a>
is meant. Also, the generation of hashes is done <em>online</em> against a
remote HTTP web API endpoint offering this function, during
transformation (which can otherwise be an offline process).</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<div>
</div>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
